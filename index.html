<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LENS OS | Film Simulation</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'Menlo', 'monospace'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- 2. React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Custom Styles -->
    <style>
        body { background-color: #000; color: white; overflow: hidden; }
        /* Hide Scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 2px; }
        
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: currentColor;
            margin-top: -6px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useMemo, useEffect } = React;

        // --- Icons (Inline SVG Components for stability) ---
        const Icons = {
            Upload: ({size=24, className}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>,
            Download: ({size=24, className}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
            Sliders: ({size=24, className}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="4" y1="21" x2="4" y2="14"/><line x1="4" y1="10" x2="4" y2="3"/><line x1="12" y1="21" x2="12" y2="12"/><line x1="12" y1="8" x2="12" y2="3"/><line x1="20" y1="21" x2="20" y2="16"/><line x1="20" y1="12" x2="20" y2="3"/><line x1="1" y1="14" x2="7" y2="14"/><line x1="9" y1="8" x2="15" y2="8"/><line x1="17" y1="16" x2="23" y2="16"/></svg>,
            Image: ({size=24, className}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>,
            RotateCcw: ({size=24, className}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>,
            X: ({size=24, className}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            Zap: ({size=24, className}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Sun: ({size=24, className}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>,
            Aperture: ({size=24, className}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="14.31" y1="8" x2="20.05" y2="17.94"/><line x1="9.69" y1="8" x2="21.17" y2="8"/><line x1="7.38" y1="12" x2="13.12" y2="2.06"/><line x1="9.69" y1="16" x2="3.95" y2="6.06"/><line x1="14.31" y1="16" x2="2.83" y2="16"/><line x1="16.62" y1="12" x2="10.88" y2="21.94"/></svg>,
            Maximize: ({size=24, className}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M15 3h6v6"/><path d="M9 21H3v-6"/><path d="M21 3l-7 7"/><path d="M3 21l7-7"/></svg>
        };

        // --- Filter Data ---
        const FILTERS = [
            {
                id: 'std', name: 'STANDARD', brand: 'NONE', desc: 'Original',
                style: { contrast: 100, saturation: 100, brightness: 100, sepia: 0, hue: 0, grayscale: 0 }
            },
            {
                id: 'hassel', name: 'HASSELBLAD', brand: 'HASSELBLAD', desc: 'Natural Color',
                style: { contrast: 105, saturation: 110, brightness: 105, sepia: 0, hue: 0, grayscale: 0 }
            },
            {
                id: 'ricoh-gr', name: 'RICOH GR', brand: 'RICOH', desc: 'High Contrast B&W',
                style: { contrast: 150, saturation: 0, brightness: 110, sepia: 0, hue: 0, grayscale: 100 }
            },
            {
                id: 'ricoh-pos', name: 'POS FILM', brand: 'RICOH', desc: 'Positive Film',
                style: { contrast: 120, saturation: 140, brightness: 100, sepia: 10, hue: -5, grayscale: 0 }
            },
            {
                id: 'fuji-nc', name: 'CLASSIC NEG', brand: 'FUJIFILM', desc: 'Nostalgic',
                style: { contrast: 115, saturation: 85, brightness: 95, sepia: 15, hue: -10, grayscale: 0 }
            },
            {
                id: 'leica-m', name: 'LEICA MONO', brand: 'LEICA', desc: 'Monochrom',
                style: { contrast: 130, saturation: 0, brightness: 100, sepia: 0, hue: 0, grayscale: 100 }
            },
            {
                id: 'portra', name: 'PORTRA 400', brand: 'KODAK', desc: 'Warm Tones',
                style: { contrast: 100, saturation: 110, brightness: 105, sepia: 20, hue: 0, grayscale: 0 }
            },
            {
                id: 'cine', name: 'CINEMATIC', brand: 'TEAL & ORANGE', desc: 'Movie Look',
                style: { contrast: 120, saturation: 120, brightness: 100, sepia: 0, hue: 10, grayscale: 0 }
            },
        ];

        // --- Main Component ---
        const App = () => {
            const [image, setImage] = useState(null);
            const [activeFilterIndex, setActiveFilterIndex] = useState(0);
            const [showParams, setShowParams] = useState(false);
            
            // Parameters
            const [params, setParams] = useState({
                exposure: 0,   // -2.0 to 2.0
                iso: 400,      // 100 to 3200
                contrast: 0,   // -30 to 30
                vignette: 0    // 0 to 100
            });

            const fileInputRef = useRef(null);
            const scrollRef = useRef(null);

            const activeFilter = useMemo(() => FILTERS[activeFilterIndex] || FILTERS[0], [activeFilterIndex]);

            // Handlers
            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => setImage(e.target.result);
                    reader.readAsDataURL(file);
                }
            };

            const resetParams = () => {
                setParams({ exposure: 0, iso: 400, contrast: 0, vignette: 0 });
            };

            const scrollToFilter = (index) => {
                setActiveFilterIndex(index);
                if (scrollRef.current) {
                    const container = scrollRef.current;
                    const items = container.children;
                    if (items[index]) {
                        const item = items[index];
                        const center = item.offsetLeft - (container.offsetWidth / 2) + (item.offsetWidth / 2);
                        container.scrollTo({ left: center, behavior: 'smooth' });
                    }
                }
            };

            // Image Processing Logic
            const imageStyle = useMemo(() => {
                const base = activeFilter.style;
                // ISO Brightness Gain (Simulated)
                const isoGain = Math.log2(params.iso / 400) * 5; 
                const exposureGain = params.exposure * 10;
                
                const finalBrightness = base.brightness + isoGain + exposureGain;
                const finalContrast = base.contrast + params.contrast;

                return {
                    filter: `brightness(${finalBrightness}%) contrast(${finalContrast}%) saturate(${base.saturation}%) sepia(${base.sepia}%) grayscale(${base.grayscale}%) hue-rotate(${base.hue}deg)`,
                    transition: 'filter 0.2s ease-out',
                };
            }, [activeFilter, params]);

            // Grain Calculation
            const grainOpacity = useMemo(() => {
                const base = 0.05;
                const isoFactor = (params.iso / 100) * 0.01;
                const bwBonus = activeFilter.style.grayscale > 0 ? 0.05 : 0;
                return Math.min(base + isoFactor + bwBonus, 0.5);
            }, [params.iso, activeFilter]);

            // Export Logic
            const handleExport = () => {
                if (!image) return;
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                img.crossOrigin = "anonymous";
                img.onload = () => {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    
                    // Filter
                    ctx.filter = imageStyle.filter;
                    ctx.drawImage(img, 0, 0);
                    ctx.filter = 'none';

                    // Vignette
                    if (params.vignette > 0) {
                        const gradient = ctx.createRadialGradient(
                            canvas.width/2, canvas.height/2, canvas.width*0.3,
                            canvas.width/2, canvas.height/2, canvas.width*0.9
                        );
                        gradient.addColorStop(0, "rgba(0,0,0,0)");
                        gradient.addColorStop(1, `rgba(0,0,0,${params.vignette/100})`);
                        ctx.fillStyle = gradient;
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                    }

                    // Download
                    const link = document.createElement('a');
                    link.download = `LENS_OS_${activeFilter.name}_${Date.now()}.jpg`;
                    link.href = canvas.toDataURL('image/jpeg', 0.92);
                    link.click();
                };
                img.src = image;
            };

            return (
                <div className="h-screen w-full flex flex-col items-center justify-center relative select-none">
                    
                    {/* Background Ambience */}
                    <div className="absolute inset-0 z-0 overflow-hidden pointer-events-none bg-black">
                        {image && <img src={image} className="w-full h-full object-cover opacity-20 blur-3xl scale-150" />}
                        <div className="absolute inset-0 bg-black/50"></div>
                    </div>

                    {/* Main Container */}
                    <div className="relative z-10 w-full max-w-md h-full max-h-[900px] flex flex-col bg-neutral-900/60 backdrop-blur-xl border-x border-white/10 shadow-2xl">
                        
                        {/* Header */}
                        <header className="px-6 py-4 flex justify-between items-end border-b border-white/5 bg-gradient-to-b from-black/60 to-transparent">
                            <div>
                                <div className="text-[10px] text-orange-500 tracking-[0.3em] font-bold mb-1">LENS OS</div>
                                <div className="text-xl font-bold tracking-wider font-mono text-white">{activeFilter.name}</div>
                            </div>
                            <div className="text-right flex gap-3 text-[10px] font-mono text-neutral-400">
                                <div className={`flex flex-col items-center ${params.iso > 800 ? 'text-orange-400' : ''}`}>
                                    <span>ISO</span>
                                    <span className="text-white text-xs">{params.iso}</span>
                                </div>
                                <div className="flex flex-col items-center">
                                    <span>EV</span>
                                    <span className="text-white text-xs">{params.exposure > 0 ? '+' : ''}{params.exposure.toFixed(1)}</span>
                                </div>
                            </div>
                        </header>

                        {/* Viewport */}
                        <div className="flex-1 relative flex items-center justify-center p-4 overflow-hidden bg-black/20">
                            <div className="relative w-full aspect-[3/4] shadow-2xl ring-1 ring-white/10 bg-black transition-all duration-300">
                                {image ? (
                                    <>
                                        <img src={image} className="w-full h-full object-contain" style={imageStyle} />
                                        {/* Grain Layer (SVG Noise) */}
                                        <div className="absolute inset-0 pointer-events-none mix-blend-overlay" style={{opacity: grainOpacity, backgroundImage: `url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")`}}></div>
                                        {/* Vignette Layer */}
                                        <div className="absolute inset-0 pointer-events-none" style={{background: `radial-gradient(circle, transparent 50%, rgba(0,0,0,${params.vignette/80}) 120%)`}}></div>
                                    </>
                                ) : (
                                    <div onClick={() => fileInputRef.current?.click()} className="absolute inset-0 flex flex-col items-center justify-center cursor-pointer hover:bg-white/5 transition-colors group">
                                        <Icons.Upload size={48} className="text-neutral-600 mb-4 group-hover:text-white transition-colors" />
                                        <span className="text-xs tracking-[0.2em] text-neutral-500">TAP TO LOAD</span>
                                    </div>
                                )}

                                {image && (
                                    <div className="absolute right-4 top-1/2 -translate-y-1/2 flex flex-col gap-4">
                                        <button onClick={() => setShowParams(!showParams)} className={`w-10 h-10 rounded-full backdrop-blur-md flex items-center justify-center border transition-all ${showParams ? 'bg-orange-600 border-orange-400 text-white' : 'bg-black/30 border-white/20 text-white hover:bg-black/60'}`}>
                                            <Icons.Sliders size={18} />
                                        </button>
                                        <button onClick={handleExport} className="w-10 h-10 rounded-full bg-black/30 backdrop-blur-md border border-white/20 flex items-center justify-center text-white hover:bg-white hover:text-black transition-all">
                                            <Icons.Download size={18} />
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Controls */}
                        <footer className="relative z-20 bg-neutral-900/90 backdrop-blur-xl border-t border-white/10">
                            {showParams ? (
                                <div className="h-52 px-6 py-4 animate-slide-up">
                                    <div className="flex justify-between items-center mb-4">
                                        <span className="text-xs font-bold text-orange-500 tracking-widest">MANUAL SETTINGS</span>
                                        <button onClick={() => setShowParams(false)} className="text-neutral-400 hover:text-white"><Icons.X size={16}/></button>
                                    </div>
                                    <div className="grid grid-cols-1 gap-4 overflow-y-auto max-h-[140px] pr-2 custom-scrollbar">
                                        {/* ISO */}
                                        <div className="space-y-1">
                                            <div className="flex justify-between text-[10px] font-mono text-neutral-400">
                                                <span className="flex items-center gap-1"><Icons.Zap size={10}/> ISO</span>
                                                <span>{params.iso}</span>
                                            </div>
                                            <input type="range" min="100" max="3200" step="100" value={params.iso} onChange={(e) => setParams({...params, iso: parseInt(e.target.value)})} className="w-full text-orange-500" />
                                        </div>
                                        {/* Exposure */}
                                        <div className="space-y-1">
                                            <div className="flex justify-between text-[10px] font-mono text-neutral-400">
                                                <span className="flex items-center gap-1"><Icons.Sun size={10}/> EXPOSURE</span>
                                                <span>{params.exposure.toFixed(1)}</span>
                                            </div>
                                            <input type="range" min="-2.0" max="2.0" step="0.1" value={params.exposure} onChange={(e) => setParams({...params, exposure: parseFloat(e.target.value)})} className="w-full text-white" />
                                        </div>
                                        {/* Vignette */}
                                        <div className="space-y-1">
                                            <div className="flex justify-between text-[10px] font-mono text-neutral-400">
                                                <span className="flex items-center gap-1"><Icons.Aperture size={10}/> VIGNETTE</span>
                                                <span>{params.vignette}</span>
                                            </div>
                                            <input type="range" min="0" max="100" value={params.vignette} onChange={(e) => setParams({...params, vignette: parseInt(e.target.value)})} className="w-full text-neutral-400" />
                                        </div>
                                        {/* Contrast */}
                                        <div className="space-y-1">
                                            <div className="flex justify-between text-[10px] font-mono text-neutral-400">
                                                <span className="flex items-center gap-1"><Icons.Maximize size={10}/> CONTRAST</span>
                                                <span>{params.contrast}</span>
                                            </div>
                                            <input type="range" min="-30" max="30" value={params.contrast} onChange={(e) => setParams({...params, contrast: parseInt(e.target.value)})} className="w-full text-neutral-400" />
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <div className="h-52 flex flex-col">
                                    <div className="flex-1 relative flex items-center">
                                        <div className="absolute left-1/2 top-0 bottom-0 w-[1px] bg-orange-500 z-30 opacity-50"></div>
                                        <div className="absolute left-0 w-16 h-full bg-gradient-to-r from-neutral-900 to-transparent z-20 pointer-events-none"></div>
                                        <div className="absolute right-0 w-16 h-full bg-gradient-to-l from-neutral-900 to-transparent z-20 pointer-events-none"></div>
                                        <div ref={scrollRef} className="w-full overflow-x-auto flex items-center px-[50%] no-scrollbar snap-x snap-mandatory py-8 gap-8">
                                            {FILTERS.map((filter, index) => (
                                                <button key={filter.id} onClick={() => scrollToFilter(index)} className={`snap-center shrink-0 flex flex-col items-center justify-center transition-all duration-300 ${activeFilterIndex === index ? 'scale-110 opacity-100' : 'scale-90 opacity-40'}`}>
                                                    <span className={`text-lg font-bold font-mono whitespace-nowrap ${activeFilterIndex === index ? 'text-white' : 'text-neutral-500'}`}>{filter.name}</span>
                                                    {activeFilterIndex === index && <span className="text-[9px] text-orange-500 tracking-wider mt-1">{filter.brand}</span>}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="h-14 border-t border-white/5 flex justify-between items-center px-8 bg-black/40">
                                        <button onClick={() => fileInputRef.current?.click()} className="text-neutral-400 hover:text-white transition-colors" title="Load Image"><Icons.Image size={20}/></button>
                                        <div className="flex gap-1 opacity-50"><div className="w-1 h-1 bg-neutral-600 rounded-full"></div><div className="w-1 h-1 bg-neutral-600 rounded-full"></div></div>
                                        <button onClick={resetParams} className="text-neutral-400 hover:text-white transition-colors" title="Reset"><Icons.RotateCcw size={20}/></button>
                                    </div>
                                </div>
                            )}
                        </footer>
                        <input type="file" ref={fileInputRef} onChange={handleFileUpload} accept="image/*" className="hidden" />
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
